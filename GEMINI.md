# GEMINI.md - Project Instructions

## Project Overview
This is a data science and Geographic Information Systems (GIS) project focused on analyzing and visualizing demographics and municipal boundaries in the St. Louis area. The project explores the consolidation of St. Louis city and county through data cleaning, spatial processing, and interactive mapping.

### Main Technologies
- **Language:** Python 3.11
- **Spatial Data:** `geopandas`, `shapely`, `pyproj`, `rtree`
- **Data Manipulation:** `pandas`, `numpy`
- **Visualization:** `altair`, `folium`, `matplotlib`, `seaborn`
- **Dashboard:** `streamlit`, `streamlit-folium`
- **Reporting:** Quarto (`.qmd` files)
- **Utilities:** `statsmodels`, `vl-convert-python` (Altair rendering), `census`, `censusdata`

## Directory Structure
- `data/`: Parent directory for all project data.
  - `raw-data/`: Raw datasets (Census CSVs, Shapefiles, finance data).
  - `derived-data/`: Processed GeoJSON files generated by the pipeline.
- `code/`: Core Python scripts.
  - `preprocessing.py`: Census API integration and spatial data cleaning.
  - `fisc_plots.py`: Financial analysis and Altair visualizations.
- `streamlit-app/`:
  - `app.py`: Interactive regional analysis dashboard.
- `environment.yml`: Comprehensive Conda environment configuration.

## Building and Running

### Prerequisites
It is highly recommended to use the provided `environment.yml` to ensure all spatial and dashboard dependencies are met:
```bash
conda env create -f environment.yml
conda activate stl_analysis
```

### Execution Workflow
1. **Data Processing:**
   Generate derived data files (requires Census API key in `code/preprocessing.py`):
   ```bash
   python code/preprocessing.py
   ```
2. **Analysis:**
   Generate financial comparisons and statistical plots:
   ```bash
   python code/fisc_plots.py
   ```
3. **Interactive Dashboard:**
   Launch the Streamlit app:
   ```bash
   streamlit run streamlit-app/app.py
   ```

## Development Conventions
- **Data Workflow:** Never modify `raw-data/`. All processing must be reproducible via `code/preprocessing.py`.
- **Portability & Pathing:** **NEVER use absolute paths.** All scripts must use `pathlib` to resolve paths relative to the project root for cross-platform and cloud compatibility (Streamlit Cloud).
- **Census API:** When using the Census module, ensure API keys are handled securely or localized in `preprocessing.py`.
- **Visualization:** Use `folium` for interactive maps in the dashboard and `altair` with `vl-convert-python` for high-resolution static exports in analysis scripts.
